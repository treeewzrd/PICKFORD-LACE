{"ast":null,"code":"var _jsxFileName = \"C:\\\\bootcamp\\\\PICKFORD---LACE\\\\client\\\\src\\\\components\\\\CartItem\\\\index.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useLazyQuery } from '@apollo/client';\nimport { QUERY_CHECKOUT } from '../../utils/queries';\nimport { idbPromise } from '../../utils/helpers';\nimport CartItem from '../CartItem';\nimport Auth from '../../utils/auth';\nimport { useGlobalState, useGlobalDispatch } from '../../utils/GlobalState';\nimport './style.css';\nimport { Button, Offcanvas } from 'react-bootstrap';\n\n// Stripe promise\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe('pk_test_TYooMQauvdEDq54NiTphI7jx');\nconst Cart = () => {\n  _s();\n  // Replace useStoreContext with useGlobalState and useGlobalDispatch\n  const state = useGlobalState();\n  const dispatch = useGlobalDispatch();\n  const navigate = useNavigate();\n  const [getCheckout, {\n    data\n  }] = useLazyQuery(QUERY_CHECKOUT);\n\n  // If there's checkout data, redirect to Stripe\n  useEffect(() => {\n    if (data) {\n      stripePromise.then(res => {\n        res.redirectToCheckout({\n          sessionId: data.checkout.session\n        });\n      });\n    }\n  }, [data]);\n\n  // Load cart from IndexedDB when component mounts\n  useEffect(() => {\n    async function getCart() {\n      const cart = await idbPromise('cart', 'get');\n      dispatch({\n        type: 'ADD_MULTIPLE_TO_CART',\n        products: [...cart]\n      });\n    }\n    if (!state.cart.length) {\n      getCart();\n    }\n  }, [state.cart.length, dispatch]);\n  function toggleCart() {\n    dispatch({\n      type: 'TOGGLE_CART'\n    });\n  }\n  function calculateTotal() {\n    return state.cart.reduce((sum, item) => {\n      return sum + item.price * (item.purchaseQuantity || item.quantity || 1);\n    }, 0).toFixed(2);\n  }\n  function submitCheckout() {\n    const productIds = [];\n    state.cart.forEach(item => {\n      for (let i = 0; i < (item.purchaseQuantity || item.quantity || 1); i++) {\n        productIds.push(item._id || item.id);\n      }\n    });\n    getCheckout({\n      variables: {\n        products: productIds\n      }\n    });\n  }\n  return /*#__PURE__*/_jsxDEV(Offcanvas, {\n    show: state.cartOpen,\n    onHide: toggleCart,\n    placement: \"end\",\n    className: \"cart-sidebar\",\n    children: [/*#__PURE__*/_jsxDEV(Offcanvas.Header, {\n      closeButton: true,\n      children: /*#__PURE__*/_jsxDEV(Offcanvas.Title, {\n        children: \"Shopping Cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Offcanvas.Body, {\n      children: state.cart.length ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [state.cart.map(item => /*#__PURE__*/_jsxDEV(CartItem, {\n          item: item\n        }, item._id || item.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 15\n        }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex justify-content-between align-items-center mt-4 mb-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Total:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"fs-4\",\n            children: [\"$\", calculateTotal()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 13\n        }, this), Auth.loggedIn() ? /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"success\",\n          className: \"w-100\",\n          onClick: submitCheckout,\n          children: \"Checkout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"primary\",\n          className: \"w-100\",\n          onClick: () => navigate('/login'),\n          children: \"Log in to check out\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center py-5\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Your cart is empty!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"outline-primary\",\n          className: \"mt-3\",\n          onClick: toggleCart,\n          children: \"Continue Shopping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 73,\n    columnNumber: 5\n  }, this);\n};\n_s(Cart, \"dcpFOgfMWbVeKYMy+gkKWhjN+TM=\", false, function () {\n  return [useGlobalState, useGlobalDispatch, useNavigate, useLazyQuery];\n});\n_c = Cart;\nexport default Cart;\nvar _c;\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"names":["React","useEffect","useNavigate","loadStripe","useLazyQuery","QUERY_CHECKOUT","idbPromise","CartItem","Auth","useGlobalState","useGlobalDispatch","Button","Offcanvas","jsxDEV","_jsxDEV","stripePromise","Cart","_s","state","dispatch","navigate","getCheckout","data","then","res","redirectToCheckout","sessionId","checkout","session","getCart","cart","type","products","length","toggleCart","calculateTotal","reduce","sum","item","price","purchaseQuantity","quantity","toFixed","submitCheckout","productIds","forEach","i","push","_id","id","variables","show","cartOpen","onHide","placement","className","children","Header","closeButton","Title","fileName","_jsxFileName","lineNumber","columnNumber","Body","map","loggedIn","variant","onClick","_c","$RefreshReg$"],"sources":["C:/bootcamp/PICKFORD---LACE/client/src/components/CartItem/index.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { useLazyQuery } from '@apollo/client';\r\nimport { QUERY_CHECKOUT } from '../../utils/queries';\r\nimport { idbPromise } from '../../utils/helpers';\r\nimport CartItem from '../CartItem';\r\nimport Auth from '../../utils/auth';\r\nimport { useGlobalState, useGlobalDispatch } from '../../utils/GlobalState';\r\nimport './style.css';\r\nimport { Button, Offcanvas } from 'react-bootstrap';\r\n\r\n// Stripe promise\r\nconst stripePromise = loadStripe('pk_test_TYooMQauvdEDq54NiTphI7jx');\r\n\r\nconst Cart = () => {\r\n  // Replace useStoreContext with useGlobalState and useGlobalDispatch\r\n  const state = useGlobalState();\r\n  const dispatch = useGlobalDispatch();\r\n  \r\n  const navigate = useNavigate();\r\n  const [getCheckout, { data }] = useLazyQuery(QUERY_CHECKOUT);\r\n\r\n  // If there's checkout data, redirect to Stripe\r\n  useEffect(() => {\r\n    if (data) {\r\n      stripePromise.then((res) => {\r\n        res.redirectToCheckout({ sessionId: data.checkout.session });\r\n      });\r\n    }\r\n  }, [data]);\r\n\r\n  // Load cart from IndexedDB when component mounts\r\n  useEffect(() => {\r\n    async function getCart() {\r\n      const cart = await idbPromise('cart', 'get');\r\n      dispatch({ \r\n        type: 'ADD_MULTIPLE_TO_CART', \r\n        products: [...cart] \r\n      });\r\n    }\r\n    \r\n    if (!state.cart.length) {\r\n      getCart();\r\n    }\r\n  }, [state.cart.length, dispatch]);\r\n\r\n  function toggleCart() {\r\n    dispatch({ type: 'TOGGLE_CART' });\r\n  }\r\n\r\n  function calculateTotal() {\r\n    return state.cart.reduce((sum, item) => {\r\n      return sum + item.price * (item.purchaseQuantity || item.quantity || 1);\r\n    }, 0).toFixed(2);\r\n  }\r\n\r\n  function submitCheckout() {\r\n    const productIds = [];\r\n    \r\n    state.cart.forEach((item) => {\r\n      for (let i = 0; i < (item.purchaseQuantity || item.quantity || 1); i++) {\r\n        productIds.push(item._id || item.id);\r\n      }\r\n    });\r\n    \r\n    getCheckout({\r\n      variables: { products: productIds },\r\n    });\r\n  }\r\n\r\n  return (\r\n    <Offcanvas \r\n      show={state.cartOpen}\r\n      onHide={toggleCart}\r\n      placement=\"end\"\r\n      className=\"cart-sidebar\"\r\n    >\r\n      <Offcanvas.Header closeButton>\r\n        <Offcanvas.Title>Shopping Cart</Offcanvas.Title>\r\n      </Offcanvas.Header>\r\n      <Offcanvas.Body>\r\n        {state.cart.length ? (\r\n          <div>\r\n            {state.cart.map(item => (\r\n              <CartItem key={item._id || item.id} item={item} />\r\n            ))}\r\n            <div className=\"d-flex justify-content-between align-items-center mt-4 mb-3\">\r\n              <strong>Total:</strong>\r\n              <span className=\"fs-4\">${calculateTotal()}</span>\r\n            </div>\r\n            {Auth.loggedIn() ? (\r\n              <Button \r\n                variant=\"success\"\r\n                className=\"w-100\"\r\n                onClick={submitCheckout}\r\n              >\r\n                Checkout\r\n              </Button>\r\n            ) : (\r\n              <Button \r\n                variant=\"primary\"\r\n                className=\"w-100\"\r\n                onClick={() => navigate('/login')}\r\n              >\r\n                Log in to check out\r\n              </Button>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-center py-5\">\r\n            <h4>Your cart is empty!</h4>\r\n            <Button \r\n              variant=\"outline-primary\"\r\n              className=\"mt-3\"\r\n              onClick={toggleCart}\r\n            >\r\n              Continue Shopping\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </Offcanvas.Body>\r\n    </Offcanvas>\r\n  );\r\n};\r\n\r\nexport default Cart;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}