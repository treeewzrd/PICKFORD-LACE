{"ast":null,"code":"var _jsxFileName = \"C:\\\\bootcamp\\\\PICKFORD---LACE\\\\client\\\\src\\\\pages\\\\Cart\\\\index.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useLazyQuery } from '@apollo/client';\nimport { QUERY_CHECKOUT } from '../../utils/queries';\nimport { idbPromise } from '../../utils/helpers';\nimport CartItem from '../../components/CartItem';\nimport Auth from '../../utils/auth';\nimport { useStoreContext } from '../../utils/GlobalState';\nimport { TOGGLE_CART, ADD_MULTIPLE_TO_CART } from '../../utils/actions';\nimport { Button, Offcanvas } from 'react-bootstrap';\n\n// Stripe promise\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe('pk_test_TYooMQauvdEDq54NiTphI7jx');\nconst Cart = () => {\n  _s();\n  const [state, dispatch] = useStoreContext();\n  const navigate = useNavigate();\n  const [getCheckout, {\n    data\n  }] = useLazyQuery(QUERY_CHECKOUT);\n\n  // If there's checkout data, redirect to Stripe\n  useEffect(() => {\n    if (data) {\n      stripePromise.then(res => {\n        res.redirectToCheckout({\n          sessionId: data.checkout.session\n        });\n      });\n    }\n  }, [data]);\n\n  // Load cart from IndexedDB when component mounts\n  useEffect(() => {\n    async function getCart() {\n      const cart = await idbPromise('cart', 'get');\n      dispatch({\n        type: ADD_MULTIPLE_TO_CART,\n        products: [...cart]\n      });\n    }\n    if (!state.cart.length) {\n      getCart();\n    }\n  }, [state.cart.length, dispatch]);\n  function toggleCart() {\n    dispatch({\n      type: TOGGLE_CART\n    });\n  }\n  function calculateTotal() {\n    return state.cart.reduce((sum, item) => {\n      return sum + item.price * item.purchaseQuantity;\n    }, 0).toFixed(2);\n  }\n  function submitCheckout() {\n    const productIds = [];\n    state.cart.forEach(item => {\n      for (let i = 0; i < item.purchaseQuantity; i++) {\n        productIds.push(item._id);\n      }\n    });\n    getCheckout({\n      variables: {\n        products: productIds\n      }\n    });\n  }\n  return /*#__PURE__*/_jsxDEV(Offcanvas, {\n    show: state.cartOpen,\n    onHide: toggleCart,\n    placement: \"end\",\n    className: \"cart-sidebar\",\n    children: [/*#__PURE__*/_jsxDEV(Offcanvas.Header, {\n      closeButton: true,\n      children: /*#__PURE__*/_jsxDEV(Offcanvas.Title, {\n        children: \"Shopping Cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Offcanvas.Body, {\n      children: state.cart.length ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [state.cart.map(item => /*#__PURE__*/_jsxDEV(CartItem, {\n          item: item\n        }, item._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 15\n        }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex justify-content-between align-items-center mt-4 mb-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Total:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"fs-4\",\n            children: [\"$\", calculateTotal()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 13\n        }, this), Auth.loggedIn() ? /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"success\",\n          className: \"w-100\",\n          onClick: submitCheckout,\n          children: \"Checkout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"primary\",\n          className: \"w-100\",\n          onClick: () => navigate('/login'),\n          children: \"Log in to check out\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center py-5\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Your cart is empty!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"outline-primary\",\n          className: \"mt-3\",\n          onClick: toggleCart,\n          children: \"Continue Shopping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n};\n_s(Cart, \"FbbeQfInm/w0/uLcs+4d81bbMlw=\", false, function () {\n  return [useStoreContext, useNavigate, useLazyQuery];\n});\n_c = Cart;\nexport default Cart;\nvar _c;\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"names":["React","useEffect","useNavigate","loadStripe","useLazyQuery","QUERY_CHECKOUT","idbPromise","CartItem","Auth","useStoreContext","TOGGLE_CART","ADD_MULTIPLE_TO_CART","Button","Offcanvas","jsxDEV","_jsxDEV","stripePromise","Cart","_s","state","dispatch","navigate","getCheckout","data","then","res","redirectToCheckout","sessionId","checkout","session","getCart","cart","type","products","length","toggleCart","calculateTotal","reduce","sum","item","price","purchaseQuantity","toFixed","submitCheckout","productIds","forEach","i","push","_id","variables","show","cartOpen","onHide","placement","className","children","Header","closeButton","Title","fileName","_jsxFileName","lineNumber","columnNumber","Body","map","loggedIn","variant","onClick","_c","$RefreshReg$"],"sources":["C:/bootcamp/PICKFORD---LACE/client/src/pages/Cart/index.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { useLazyQuery } from '@apollo/client';\r\nimport { QUERY_CHECKOUT } from '../../utils/queries';\r\nimport { idbPromise } from '../../utils/helpers';\r\nimport CartItem from '../../components/CartItem';\r\nimport Auth from '../../utils/auth';\r\nimport { useStoreContext } from '../../utils/GlobalState';\r\nimport { TOGGLE_CART, ADD_MULTIPLE_TO_CART } from '../../utils/actions';\r\nimport { Button, Offcanvas } from 'react-bootstrap';\r\n\r\n// Stripe promise\r\nconst stripePromise = loadStripe('pk_test_TYooMQauvdEDq54NiTphI7jx');\r\n\r\nconst Cart = () => {\r\n  const [state, dispatch] = useStoreContext();\r\n  const navigate = useNavigate();\r\n  const [getCheckout, { data }] = useLazyQuery(QUERY_CHECKOUT);\r\n\r\n  // If there's checkout data, redirect to Stripe\r\n  useEffect(() => {\r\n    if (data) {\r\n      stripePromise.then((res) => {\r\n        res.redirectToCheckout({ sessionId: data.checkout.session });\r\n      });\r\n    }\r\n  }, [data]);\r\n\r\n  // Load cart from IndexedDB when component mounts\r\n  useEffect(() => {\r\n    async function getCart() {\r\n      const cart = await idbPromise('cart', 'get');\r\n      dispatch({ type: ADD_MULTIPLE_TO_CART, products: [...cart] });\r\n    }\r\n    if (!state.cart.length) {\r\n      getCart();\r\n    }\r\n  }, [state.cart.length, dispatch]);\r\n\r\n  function toggleCart() {\r\n    dispatch({ type: TOGGLE_CART });\r\n  }\r\n\r\n  function calculateTotal() {\r\n    return state.cart.reduce((sum, item) => {\r\n      return sum + item.price * item.purchaseQuantity;\r\n    }, 0).toFixed(2);\r\n  }\r\n\r\n  function submitCheckout() {\r\n    const productIds = [];\r\n    state.cart.forEach((item) => {\r\n      for (let i = 0; i < item.purchaseQuantity; i++) {\r\n        productIds.push(item._id);\r\n      }\r\n    });\r\n    getCheckout({\r\n      variables: { products: productIds },\r\n    });\r\n  }\r\n\r\n  return (\r\n    <Offcanvas \r\n      show={state.cartOpen}\r\n      onHide={toggleCart}\r\n      placement=\"end\"\r\n      className=\"cart-sidebar\"\r\n    >\r\n      <Offcanvas.Header closeButton>\r\n        <Offcanvas.Title>Shopping Cart</Offcanvas.Title>\r\n      </Offcanvas.Header>\r\n      <Offcanvas.Body>\r\n        {state.cart.length ? (\r\n          <div>\r\n            {state.cart.map(item => (\r\n              <CartItem key={item._id} item={item} />\r\n            ))}\r\n            <div className=\"d-flex justify-content-between align-items-center mt-4 mb-3\">\r\n              <strong>Total:</strong>\r\n              <span className=\"fs-4\">${calculateTotal()}</span>\r\n            </div>\r\n            {Auth.loggedIn() ? (\r\n              <Button \r\n                variant=\"success\"\r\n                className=\"w-100\"\r\n                onClick={submitCheckout}\r\n              >\r\n                Checkout\r\n              </Button>\r\n            ) : (\r\n              <Button \r\n                variant=\"primary\"\r\n                className=\"w-100\"\r\n                onClick={() => navigate('/login')}\r\n              >\r\n                Log in to check out\r\n              </Button>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-center py-5\">\r\n            <h4>Your cart is empty!</h4>\r\n            <Button \r\n              variant=\"outline-primary\"\r\n              className=\"mt-3\"\r\n              onClick={toggleCart}\r\n            >\r\n              Continue Shopping\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </Offcanvas.Body>\r\n    </Offcanvas>\r\n  );\r\n};\r\n\r\nexport default Cart;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}